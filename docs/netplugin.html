<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Learn about Contiv Network.">

    <link rel="shortcut icon" href="/assets/images/favicon.png">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <title>Netplugin - Contiv</title>

    <link href="/assets/stylesheets/application-f0d09056.css" rel="stylesheet"/>

    <!--[if lt IE 9]><script src="/assets/javascripts/html5shiv-099439cc.js"></script><script src="/assets/javascripts/respond.min-1eb35b04.js"></script><![endif]-->

    
  </head>

  <body id="page-Netplugin" class=" page-Netplugin layout-docs page-sub">

<div id="header" class="navbar-static-top">
  <div class="container">
    <div class="row">
      
        <div class="navbar-header">
          <div class="navbar-brand">
            <a href="http://www.cisco.com"><img class="logo" src="/assets/images/cisco-b5d79772.png">
              <a class="logo" href="/">Contiv</a>
            </a>
          </div>
          
        </div>
        <div class="buttons hidden-xs">
          <nav role="navigation">
            <ul class="main-links nav navbar-nav navbar-left">
              <li class="first li-under"><a href="/install/index.html">Documentation</a></li>
              <li class="li-under"><a href="/articles/index.html">Articles</a></li>
              <li class="li-under"><a href="https://github.com/contiv" target="_blank">
                        GitHub
                        <i class="fa fa-github fa-lg"></i>
                        </a></li>
                    <li class="li-under"><a href="https://contiv.slack.com" target="_blank">
                        Slack
                        <i class="fa fa-slack fa-lg"></i>
                        </a></li>
                    <li><a href="https://twitter.com/projectcontiv" target="_blank">
                        Twitter
                        <i class="fa fa-twitter fa-lg"></i>
                        </a></li>
            </ul>
          </nav>
        </div>
      
    </div>
  </div>
</div>


<div class="sidebar-overlay"></div>


<aside id="sidebar" class="sidebar sidebar-default sidebar-fixed-right" role="navigation">
    
    <div class="sidebar-header header-cover">
        
        <div class="sidebar-image">
            <img src="/assets/images/logo-header@2x.png" width="49px" height="56px">
        </div>
    </div>

    
    <ul class="main nav sidebar-nav">
        <li class="first"><a href="/intro/index.html">Intro</a></li>
        <li class=""><a href="/docs/index.html">Docs</a></li>
    </ul>
    <div class="divider"></div>
    
    <ul class="external nav sidebar-nav">
        <li class=""><a class="v-btn gray sml" href="https://github.com/contiv"><svg id="svg-download" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14" style="enable-background:new 0 0 14 14;">
  <style>
  </style>
  <path class="" d="M13,0H1C0.5,0,0,0.5,0,1v12c0,0.5,0.5,1,1,1h4.7c0,0,0,0,0-0.1c0-0.2,0-0.6,0-1.1c-1.8,0.4-2.2-0.9-2.2-0.9
    c-0.3-0.8-0.7-1-0.7-1c-0.6-0.4,0-0.4,0-0.4c0.7,0,1,0.7,1,0.7c0.6,1,1.5,0.7,1.9,0.5c0.1-0.4,0.2-0.7,0.4-0.9c-1.5-0.2-3-0.7-3-3.2
    c0-0.7,0.3-1.3,0.7-1.8C3.7,5.8,3.5,5.1,3.9,4.2c0,0,0.6-0.2,1.8,0.7c0.5-0.1,1.1-0.2,1.6-0.2c0.6,0,1.1,0.1,1.6,0.2
    c1.3-0.8,1.8-0.7,1.8-0.7c0.4,0.9,0.1,1.6,0.1,1.7c0.4,0.5,0.7,1,0.7,1.8c0,2.5-1.5,3.1-3,3.2C8.7,11.1,9,11.5,9,12.1
    c0,0.9,0,1.6,0,1.8c0,0,0,0,0,0.1h4c0.5,0,1-0.5,1-1V1C14,0.5,13.5,0,13,0z"/>
</svg>
GitHub</a></li>
    </ul>
</aside>


<div class="container">
	<div class="row">
		<div class="col-md-3 col-sm-3 col-xs-12">
					<div class="docs-sidebar hidden-print affix-top" role="complementary">
			<ul class="nav docs-sidenav">
				<li>
					<a href="/docs/index.html">Documentation Home</a>
				</li>

				<li class="active">
					<a href="/docs/netplugin.html">Contiv Network</a>
				</li>

				<li>
					<a href="/docs/volplugin.html">Contiv Storage</a>
                </li>
			</ul>
		</div>

		</div>  
		<div id="main-content" class="col-sm-9 col-md-9 col-xs-12" role="main">
			<div class="bs-docs-section">
				
	<h1>Contiv Network</h1>

<h2>About</h2>
<p>Contiv Network is a generic networking plugin that is designed to provide multi host policy based networking for containerized applications.</p>
<p>Contiv Network is designed to be used with Docker containers and with cluster schedulers like Swarm, Kubernetes and Mesos.</p>

<h2>Getting started</h2>
<p>This section will walk you through how to try Contiv Network in a Vagrant environment.</p>

<h3>Prerequisits</h3>

<ul>
<li>VirtualBox 5.0.2 or greater
</li>
<li>Vagrant 1.7.4
</li>
<li>Git
</li>
<li>Make
</li>
</ul>

<h3>Quick Start Guide</h3>
<p>Clone the repo and bring up the VMs.</p>
<pre class="highlight plaintext"><code>$ git clone https://github.com/contiv/netplugin
$ cd netplugin; make demo
$ vagrant ssh netplugin-node1
</code></pre>
<p>This starts a cluster of two VMs running Docker and Contiv Network.</p>

<h4>Step 1: Create a Network</h4>
<pre class="highlight plaintext"><code>netplugin-node1$ netctl net create contiv-net --subnet=20.1.1.0/24 --gateway=20.1.1.254 --pkt-tag=1001
</code></pre>

<h4>Step 2: Run containers on two hosts</h4>
<p>On node1</p>
<pre class="highlight plaintext"><code>netplugin-node1$ docker run -itd --name=web --net=contiv-net ubuntu /bin/bash
</code></pre>
<p>On node2</p>
<pre class="highlight plaintext"><code>netplugin-node2$ docker run -itd --name=db --net=contiv-net ubuntu /bin/bash
</code></pre>
<p>On node1, login to the container and ping the container on node2</p>
<pre class="highlight plaintext"><code>netplugin-node1$ docker exec -it web /bin/bash
&lt; inside the container &gt;
root@f90e7fd409c4:/# ping db
PING db (20.1.1.3) 56(84) bytes of data.
64 bytes from db (20.1.1.3): icmp_seq=1 ttl=64 time=0.658 ms
64 bytes from db (20.1.1.3): icmp_seq=2 ttl=64 time=0.103 ms
</code></pre>

<h2>Architecture</h2>

<h4>Glossary</h4>

<ul>
<li><em>Netmaster</em>: Netmaster is the master daemon that is responsible for storing the Intent and distributing state to all nodes in the cluster.
</li>
<li><em>netplugin</em>: netplugin is a long running daemon on every node in the cluster. As a Docker network plugin, it is responsible for setting up network and policy for each container.
</li>
<li> <em>netctl</em>: netctl is a command line tool to modify the intent.
</li>
</ul>

<h4>Contiv Network Architecture</h4>
<p><img alt="Architecture" src="/docs/netplugin-arch-a8311b3b.jpg"/></p>

<h3>Contiv Object Model</h3>
<p>Contiv Object model provides a way for users to specify their Intent. Netmaster provides a REST api to view and modify contiv object model. Netctl commandline tool is a convinient utility to interact with the object model</p>
<p><img alt="Object model" src="/docs/contivModel-14eb20c0.png"/></p>
<p>From networking perspective, objects of interest are tenant, network, endpoint-group, policy and rules.</p>

<h4>Tenant</h4>
<p>Tenant is the top level object that represents a tenant in a multi tenant environment. It could be an organization, a business unit or a project. Anything that requires complete isolation between its networks would be considered a tenant.</p>

<h4>Network</h4>
<p>Network represents an L3 network similar to a virtual private cloud or a VRF. Contiv networks are large L3 domains where packets are routed by IP address without any ARP broadcasting.</p>

<h4>Endpoint group</h4>
<p>Endpoint groups are an arbitrary grouping of containers which belong to same policy domain. An endpoint group generally represents a microservice, a tier in an application stack or set of containers belonging to same framework or job.</p>

<h4>Policy</h4>
<p>Policy represents a network security policy that can be applied to an endpoint group. Policy contains a list of rules.</p>

<h4>Rule</h4>
<p>Rule is made up of match conditions(IP address, port, network, endpoint groups) and action(allow or deny). Rules are generally stateful. For example, &quot;deny incoming tcp&quot; denies all incoming TCP connections not packets. Incoming TCP packet for an already established connection will be allowed.</p>

<h2>Using Policies</h2>
<p>Using policies with containers requires (1) creating a policy (2) adding rules to a policy (3) creating an endpoint group (4) attaching containers to the endpoint group. Lets walk thorough each of these steps.</p>

<h4>Step1: Create a policy</h4>
<p>Following creates a policy named <code>prod_web</code></p>
<pre class="highlight plaintext"><code>$ netctl policy create prod_web
</code></pre>

<h4>Step 2: Add rules to the policy</h4>
<p>Following adds a default-deny rule to drop all incoming TCP connections and two specific rules to allow traffic on port 80 and 443</p>
<pre class="highlight plaintext"><code>$ netctl policy rule-add prod_web 1 -direction=in -protocol=tcp -action=deny
$ netctl policy rule-add prod_web 2 -direction=in -protocol=tcp -port=80 -action=allow -priority=10
$ netctl policy rule-add prod_web 3 -direction=in -protocol=tcp -port=443 -action=allow -priority=10
</code></pre>

<h4>Step 3: Create an endpoint group</h4>
<p>Following command creates an endpoint group named <code>web</code> in network <code>contiv-net</code> and attaches <code>prod_web</code> policy to it</p>
<pre class="highlight plaintext"><code>$ netctl group create contiv-net web -policy=prod_web
</code></pre>
<p><em>Note</em>: Each endpoint group will create a seperate Docker network of the form <endpoint-group-name>.<network-name> You can attach containers to these endpoint groups using <code>--net</code> option in <code>docker run</code> command</p>

<h4>Step 4: Run a container and attach it to the endpoint group</h4>
<p>Following runs a Docker container and attaches it to <code>web</code> endpoint group in <code>contiv-net</code> network</p>
<pre class="highlight plaintext"><code>$ docker run -itd --net web.contiv-net ubuntu bash
</code></pre>

<h2>Using Contiv Network with Docker Swarm</h2>
<p>Docker Swarm is a scheduler that schedules containers to multiple hosts. Contiv Network is a Docker network plugin that provides multi host networking.</p>

<h3>Using Swarm</h3>
<p>The Contiv Network Vagrant setup comes pre-installed with Docker Swarm.
Set the following environment variable to make Docker client talk to Swarm</p>
<pre class="highlight plaintext"><code>export DOCKER_HOST=tcp://192.168.2.10:2375
</code></pre>
<p>With this environment variable set, Docker operates on the entire Swarm cluster, not just the local Docker instance.</p>
<pre class="highlight plaintext"><code>$ docker info
Containers: 0
Images: 5
Engine Version:
Role: primary
Strategy: spread
Filters: affinity, health, constraint, port, dependency
Nodes: 2
 netplugin-node1: 192.168.2.10:2385
  └ Containers: 0
  └ Reserved CPUs: 0 / 4
  └ Reserved Memory: 0 B / 2.051 GiB
  └ Labels: executiondriver=native-0.2, kernelversion=4.0.0-040000-generic, operatingsystem=Ubuntu 15.04, storagedriver=devicemapper
 netplugin-node2: 192.168.2.11:2385
  └ Containers: 0
  └ Reserved CPUs: 0 / 4
  └ Reserved Memory: 0 B / 2.051 GiB
  └ Labels: executiondriver=native-0.2, kernelversion=4.0.0-040000-generic, operatingsystem=Ubuntu 15.04, storagedriver=devicemapper
CPUs: 8
Total Memory: 4.103 GiB
Name: netplugin-node1
No Proxy: 192.168.0.0/16,localhost,127.0.0.0/8
</code></pre>
<p>Next, you can query for any containers running in the cluster.</p>
<pre class="highlight plaintext"><code>$ docker ps
CONTAINER ID        IMAGE                          COMMAND             CREATED             STATUS              PORTS               NAMES
4dd09bc36875        ubuntu                         "bash"              52 minutes ago      Up 52 minutes                           netplugin-node1/reverent_allen
18bdc2cde778        skynetservices/skydns:latest   "/skydns"           3 hours ago         Up 3 hours          53/udp, 53/tcp      netplugin-node1/defaultdns

</code></pre>
<p>You can run containers and attach them to Contiv networks or endpoint groups just like before.</p>
<pre class="highlight plaintext"><code>$ docker run -itd --net web.contiv-net ubuntu bash
f291e269b45a5877f6fc952317feb329e12a99bda3a44a740b4c3307ef87954c
</code></pre>
<p>Here, <code>docker run</code> happens against the Swarm cluster. Swarm schedules the container to one of the nodes and Contiv Network on that node sets up the networking and policies just like before.</p>

<h2>Service Discovery</h2>
<p>Contiv Network provides built-in service discovery for all containers in the network. Unlike traditional service discovery tools which require applications to query external KV stores for container IP and port information, Contiv service discovery uses the standard DNS protocol and requires no changes to the application.</p>
<p>When a container is attached to an endpoint group, it automatically becomes reachable by DNS service name. In the example above, we ran a container and attached it to <code>web</code> endpoint group. This container becomes available by the DNS name <code>web</code> for all other containers in the same network. It is available as <code>web.contiv-net</code> for all containers in other networks within the same tenant. If there are multiple containers in same endpoint group, all of them are available by the same DNS service name. DNS queries are load balanced across all containers in the group.</p>

<h2>Multi Tenancy</h2>

<h2>Using Contiv Network on Baremetal Servers</h2>

<h2>Using Contiv Network with Kubernetes</h2>

<h2>Working with Cisco ACI</h2>


			</div>
		</div>
	</div>
</div>